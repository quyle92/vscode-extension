module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("vscode")},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.setTabNineStatus=t.statusBarItem=t.TabNineStatus=void 0;const a=o(n(0));var s;!function(e){e[e.None=0]="None",e[e.Disabled=1]="Disabled",e[e.ActivationError=2]="ActivationError",e[e.BinaryDoesNotExist=3]="BinaryDoesNotExist",e[e.ParsingError=4]="ParsingError",e[e.ParsingSuccess=5]="ParsingSuccess",e[e.TimedOut=6]="TimedOut",e[e.ProcessExited=7]="ProcessExited",e[e.ProcessDead=8]="ProcessDead",e[e.ProcessRunning=9]="ProcessRunning",e[e.ProcessFailedToStart=10]="ProcessFailedToStart",e[e.DownloadingBinary=11]="DownloadingBinary"}(s=t.TabNineStatus||(t.TabNineStatus={})),t.statusBarItem=a.window.createStatusBarItem(a.StatusBarAlignment.Right),t.setTabNineStatus=function(e,n){switch(t.statusBarItem.tooltip=n,e){case s.Disabled:case s.BinaryDoesNotExist:t.statusBarItem.text="TabNine: $(eye-closed)";break;case s.ActivationError:case s.ParsingError:case s.ProcessExited:case s.ProcessDead:case s.ProcessFailedToStart:t.statusBarItem.text="TabNine: $(error)";break;case s.ParsingSuccess:case s.ProcessRunning:t.statusBarItem.text="TabNine: $(check)";break;case s.TimedOut:t.statusBarItem.text="TabNine: $(watch)";break;case s.DownloadingBinary:t.statusBarItem.text="TabNine: $(sync~spin)";break;default:t.statusBarItem.text="TabNine"}}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.logError=t.showErrorMessage=t.downloadTabNineBinary=t.getTabNineVersionAndBinaryPath=void 0;const a=o(n(7)),s=o(n(8)),u=o(n(9)),c=o(n(0)),l=n(1),d=a.promises,f=u.join(__dirname,"..","binaries");function b(e){const t=function(){if("x32"===process.arch||"ia32"===process.arch)return"i686";if("x64"===process.arch)return"x86_64";throw new Error(`Architecture "${process.arch}" is not supported by TabNine`)}(),{target:n,filename:r}=function(){if("win32"===process.platform)return{target:"pc-windows-gnu",filename:"TabNine.exe"};if("darwin"===process.platform)return{target:"apple-darwin",filename:"TabNine"};if("linux"===process.platform)return{target:"unknown-linux-musl",filename:"TabNine"};throw new Error(`Platform "${process.platform}" is not supported by TabNine`)}();return`${f}/${e}/${t}-${n}/${r}`}async function p(e){try{return await d.stat(e),!0}catch(e){if("ENOENT"===e.code)return!1;throw e}}t.getTabNineVersionAndBinaryPath=async function(){const e=(await d.readdir(f)).reverse(),t=[];for(const n of e){const e=b(n);if(t.push(e),await p(e))return{version:n,binaryPath:e}}throw new Error(`Couldn't find TabNine binary (tried following versions=${e} and paths=${t})`)},t.downloadTabNineBinary=async function(e){if(e&&await p(b(e)))return!0;const t=await async function(){return new Promise((e,t)=>{const n="https://update.tabnine.com/version",r=s.get(n,{timeout:1e4},n=>{let r="";n.on("data",e=>r+=e),n.on("end",()=>e(r.trim())),n.on("error",e=>t(e))});r.on("timeout",()=>t(`Request to ${n} timed out`)),r.on("error",e=>t(e))})}();return c.window.withProgress({location:c.ProgressLocation.Notification,cancellable:!0,title:`Downloading TabNine ${t} binary...`},(e,n)=>new Promise(async(r,i)=>{try{const o=b(t),u=o.slice(0,o.lastIndexOf("/"));let f;await d.mkdir(u,{recursive:!0});const p="https://update.tabnine.com/"+o.slice(o.indexOf(t)),m=s.get(p,{timeout:1e4},s=>{const u=a.createWriteStream(o,{mode:493});u.on("error",e=>i(e));let l=0,d=0;s.on("data",t=>{if(!f)return;l+=t.length;const n=Number((100*l/Number.parseInt(f)).toFixed());0===d?e.report({increment:0}):n>d&&e.report({increment:1}),d=n}).on("error",e=>i(e)).on("end",()=>{n.isCancellationRequested||(e.report({increment:100}),c.window.showInformationMessage(`TabNine ${t} binary is successfully downloaded`),r(!0))}).pipe(u).on("error",e=>i(e)),n.onCancellationRequested(()=>{s.destroy(),u.destroy()})});m.on("response",e=>{l.setTabNineStatus(l.TabNineStatus.DownloadingBinary,`Downloading TabNine ${t} binary`),f=e.headers["content-length"]}),m.on("timeout",()=>i(`Request to ${p} timed out`)),m.on("error",e=>i(e)),n.onCancellationRequested(()=>{d.unlink(o).catch(e=>i(e)),m.destroy(),i("Download of TabNine binary has been cancelled")})}catch(e){i(e)}}))},t.showErrorMessage=function(e){c.window.showErrorMessage(e instanceof Error?e.message:e)},t.logError=function(e){console.error(e instanceof Error?e.message:e)}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=void 0;const a=o(n(0)),s=n(4),u=n(1),c=n(5),l=n(10),d=n(2),f=s.getVSCodeConfig();async function b(e,t,n){try{if(null==n?void 0:n.isCancellationRequested)return;const r=e.offsetAt(t),i=Math.max(0,r-f.charLimit),o=r+f.charLimit,s=e.positionAt(i),u=e.positionAt(o),l=e.getText(new a.Range(s,t)),d=e.getText(new a.Range(t,u)),b=await c.sendRequestToTabNine({Autocomplete:{filename:e.fileName,before:l,after:d,region_includes_beginning:0===i,region_includes_end:e.offsetAt(u)!==o,max_num_results:f.maxNumberOfResults}},f.requestTimeout,null==n?void 0:n.onCancellationRequested);if(null==n?void 0:n.isCancellationRequested)return;if(f.debug&&console.log(b),0===b.results.length)return;const p=t.translate(0,-b.old_prefix.length),m=b.user_message.join(" "),g=[];let T=b.results.length;T>f.maxNumberOfResults&&(T=f.maxNumberOfResults);for(let e=0;e<T;e++){const n=b.results[e],r=new a.CompletionItem(n.new_prefix);(n.new_prefix.endsWith(".")||n.new_prefix.endsWith("::"))&&(r.command={title:"",command:"editor.action.triggerSuggest"}),n.detail?r.detail=n.detail:r.detail="TabNine",n.documentation?"object"==typeof n.documentation?"markdown"===n.documentation.kind?r.documentation=new a.MarkdownString(n.documentation.value):r.documentation=n.documentation.value:r.documentation=n.documentation:r.documentation=m,r.insertText=new a.SnippetString(n.new_prefix),n.new_suffix&&(r.label+=n.new_suffix,r.insertText.appendTabstop(0).appendText(n.new_suffix)),r.kind=a.CompletionItemKind.Text,r.range=new a.Range(p,t.translate(0,n.old_suffix.length)),r.sortText="ï¿¿9999"+e,g.push(r)}return new a.CompletionList(g,!0)}catch(e){f.debug&&d.logError(e)}}function p(e){return a.commands.registerCommand(e,async()=>{var t,n;try{const r=await c.sendRequestToTabNine({Autocomplete:{filename:null!==(n=null===(t=a.window.activeTextEditor)||void 0===t?void 0:t.document.fileName)&&void 0!==n?n:"",before:e,after:e,region_includes_beginning:!0,region_includes_end:!0,max_num_results:1}},1e3);a.window.showInformationMessage(r.results[0].new_prefix)}catch(e){d.showErrorMessage(e)}})}t.activate=async function(e){try{if(u.setTabNineStatus(u.TabNineStatus.None),u.statusBarItem.show(),e.subscriptions.push(u.statusBarItem),!f.enable)return void u.setTabNineStatus(u.TabNineStatus.Disabled,"TabNine is disabled via config");if(!await d.downloadTabNineBinary(e.globalState.get("TABNINE_VERSION")))return void u.setTabNineStatus(u.TabNineStatus.BinaryDoesNotExist,"TabNine binary does not exist");c.startAndHookIntoTabNineProcess().then(t=>{e.globalState.update("TABNINE_VERSION",t)}).catch(e=>{u.setTabNineStatus(u.TabNineStatus.ProcessFailedToStart,"TabNine process failed to start"),d.showErrorMessage(e)});const t=await a.languages.getLanguages(),n=[];t.forEach(e=>{f.disabledLanguagesIds.includes(e)||n.push({scheme:"file",language:e},{scheme:"untitled",language:e})}),e.subscriptions.push(a.languages.registerCompletionItemProvider(n,{provideCompletionItems:b},l.Trigger.DOT,l.Trigger.COLON),p("TabNine::config"),p("TabNine::restart"),p("TabNine::sem"),p("TabNine::no_sem"))}catch(e){u.setTabNineStatus(u.TabNineStatus.ActivationError,e instanceof Error?e.message:e),d.showErrorMessage(e)}}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getVSCodeConfig=void 0;const a=o(n(0));t.getVSCodeConfig=function(){return a.workspace.getConfiguration("tabnine")}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.startAndHookIntoTabNineProcess=t.sendRequestToTabNine=void 0;const a=o(n(6)),s=n(1),u=n(2);let c,l,d=0,f=!1;function b(e){(null==c?void 0:c.killed)||(e&&u.logError(e),f=!1,setTimeout(()=>async function(){if(f)return;if(d>=10)return void u.logError("TabNine process exceeded maximum number of restarts");d+=1,null==c||c.kill(),c=void 0,await p()}(),1e4))}async function p(){var e,t;const{version:n,process:r}=await async function(e=!1,...t){const{version:n,binaryPath:r}=await u.getTabNineVersionAndBinaryPath();return{version:n,process:a.spawn(r,["--client=vscode",...t],{stdio:e?"inherit":"pipe"})}}();return l=n,c=r,f=!0,s.setTabNineStatus(s.TabNineStatus.ProcessRunning,`TabNine ${l} process is running`),c.on("exit",()=>{b()}),null===(e=c.stdin)||void 0===e||e.on("error",e=>{b("TabNine stdin error: "+e)}),null===(t=c.stdout)||void 0===t||t.on("error",e=>{b("TabNine stdout error: "+e)}),c.unref(),n}t.sendRequestToTabNine=async function(e,t,n){e={version:l,request:e};const r=[],i=new Promise((t,n)=>{var i,o;const a=e=>{try{s.setTabNineStatus(s.TabNineStatus.ParsingSuccess,`TabNine ${l} process is running`),t(JSON.parse(e.toString()))}catch(e){s.setTabNineStatus(s.TabNineStatus.ParsingError,"Error while parsing response from TabNine"),n("TabNine response parsing error: "+e)}};null===(i=null==c?void 0:c.stdout)||void 0===i||i.once("data",a),r.push(()=>{var e;null===(e=null==c?void 0:c.stdout)||void 0===e||e.off("data",a)});const u=JSON.stringify(e)+"\n";null===(o=null==c?void 0:c.stdin)||void 0===o||o.write(u,"utf-8")}),o=new Promise((e,n)=>{const i=setTimeout(()=>{s.setTabNineStatus(s.TabNineStatus.TimedOut,"Request to TabNine timed out"),n("Request to TabNine timed out")},t);r.push(()=>clearTimeout(i))}),a=new Promise((e,t)=>{const n=()=>{s.setTabNineStatus(s.TabNineStatus.ProcessExited,"TabNine process exited"),t("TabNine process exited")};null==c||c.once("exit",n),r.push(()=>{null==c||c.off("exit",n)})}),u=new Promise((e,t)=>{f||(s.setTabNineStatus(s.TabNineStatus.ProcessDead,"TabNine process is currently dead"),t("TabNine process is currently dead"))}),d=new Promise((e,t)=>{null==n||n(()=>{t("Token has been cancelled")})});return Promise.race([i,o,a,u,d]).finally(()=>{r.forEach(e=>e())})},t.startAndHookIntoTabNineProcess=p},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Trigger=void 0,function(e){e.DOT=".",e.COLON=":"}(t.Trigger||(t.Trigger={}))}]);
//# sourceMappingURL=main.js.map